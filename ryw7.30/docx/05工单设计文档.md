###连带分析看板设计文档


**一、项目目标**

分析用户访问主商品时是否对其他商品（连带商品）产生兴趣或行为（浏览、加购、下单），从而识别潜在搭配、推荐组合或营销组合策略。

**一、ODS层（操作明细层）**

**表设计**

表名：gongdan.ods_user_action

结构字段：

user_id STRING — 用户ID

sku_id STRING — 商品ID

action_type STRING — 用户行为类型（exposure, click, cart, fav, pay, detail）

action_time TIMESTAMP — 行为发生时间

device_type STRING — 设备类型（mobile, pc, tablet）

p_address STRING — IP地址

channel STRING — 渠道来源（organic, ads, referral, direct）

session_id STRING — 会话ID

refer_url STRING — 来源页面

user_agent STRING — 用户浏览器标识

dt STRING — 分区字段，记录日期

**原始数据分析**

行为数据量约6000条，主商品占60%访问比例。

用户行为多样，包含浏览曝光、点击、加购、收藏、支付、详情页访问。

设备和渠道分布广泛，满足多维分析需求。

设计了“连带行为”：访问主商品时，40%概率产生相关商品的行为，模拟真实用户交叉浏览、购买场景。

**关键指标及实现思路**

数据完整性：保证行为类型分布合理，主商品访问量高，保证后续连带分析有足够数据支撑。

真实场景模拟：利用随机及概率控制行为生成，特别是主商品与相关商品的时间窗连带行为。

分区存储：按日期分区，提高查询效率。

**二、DIM层（维度层）**

**表设计**

表名：gongdan.dim_sku

结构字段：

sku_id STRING — 商品ID，主键

sku_name STRING — 商品名称（英文）

brand_id STRING — 品牌ID

category_id STRING — 类别ID

price DOUBLE — 商品价格

listing_date TIMESTAMP — 上架时间

stock_quantity INT — 库存数量

supplier STRING — 供应商

rating DOUBLE — 评分（1~5）

**原始数据分析**

共100个商品，涵盖20品牌、10类目、5供应商，数据结构丰富。

商品价格及评分分布广泛，方便进行价格带、品牌效应分析。

上架时间跨度近两年，支持新品分析。

**关键指标及实现思路**

维度表完整且字段丰富，满足多维度业务分析和筛选。

商品名称采用英文格式，避免乱码，提升系统兼容性。

定期刷新，维度更新时保证数据一致性。

**三、DWD层（宽表层）**

**表设计**

表名：gongdan.dwd_user_sku_action

结构字段：ODS层字段 + DIM层字段整合

主要是关联用户行为表和商品维度表，形成宽表

**原始数据分析**

将用户行为表中的商品ID关联商品维度，补全商品信息。

确保每条行为记录带上商品的详细属性，方便后续指标计算。

**关键指标及实现思路**

通过JOIN将ODS行为和DIM维度关联，构建宽表，便于分析。

只处理当天数据，减少计算资源消耗。

宽表设计支持多种行为和商品属性维度的联合分析。

**四、DWS层（主题宽表层）**

**表设计**

表名：gongdan.dws_main_sku_related_actions

字段：

main_sku STRING — 主商品ID（重点分析对象）

related_sku STRING — 关联商品ID

action_type STRING — 行为类型

action_cnt BIGINT — 行为次数计数

**原始数据分析**

选择了10个主商品作为核心分析对象。

通过用户ID和时间窗（±30分钟）匹配，识别主商品与其他商品的关联行为。

统计不同行为类型的发生次数，形成关联矩阵。

**关键指标及实现思路**

通过“同一用户、时间窗口内”发生的主商品与其他商品行为关联，捕捉潜在连带销售机会。

时间窗口扩大到30分钟，兼顾用户实际浏览节奏。

分行为类型统计，区分点击、加购、支付等关键动作。

支持后续ADS层汇总和业务优化决策。

**五、ADS层（指标汇总层）**

**表1：主商品连带行为分析**

表名：gongdan.ads_main_sku_related_behavior

结构字段：

main_sku STRING

related_sku STRING

related_click_cnt BIGINT

related_cart_cnt BIGINT

related_pay_cnt BIGINT

**表2：详情页引导能力分析**

表名：gongdan.ads_detail_page_guide_analysis

结构字段：

sku_id STRING

detail_uv BIGINT — 详情页访问用户数

click_uv BIGINT — 点击用户数

cart_uv BIGINT — 加购用户数

pay_uv BIGINT — 支付用户数

**原始数据分析**

统计主商品对相关商品在点击、加购、支付的影响力，分析用户连带购买行为。

统计每个商品详情页的访问和转化漏斗指标，衡量详情页引导效果。

**关键指标及实现思路**

通过对DWS层行为次数汇总，形成清晰的连带行为指标，支持商品关联营销。

详情页指标基于去重用户数（UV），客观反映转化链路的效率。

ADS层数据每日刷新，支持业务实时监控与优化。

**总体实现思路**

1. **数据采集（ODS）**：模拟真实用户行为，数据量和行为类型均衡，保证数据质量和丰富度。
2. **维度构建（DIM）**：设计丰富的商品维度表，补全商品属性。
3. **数据融合（DWD）**：宽表层通过JOIN操作融合行为与维度数据，方便指标计算。
4. **行为关联（DWS）**：通过用户同一时间窗行为匹配，计算主商品与关联商品的连带行为次数。
5. **指标汇总（ADS）**：对连带行为进行聚合统计，输出关键业务指标，支持商家做精准营销及优化详情页。
6. **性能优化**：

分区设计（ODS层日期分区）

动态分区写入配置

主商品数量和时间窗口调整，保证数据覆盖充足
