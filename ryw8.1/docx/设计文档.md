###
**页面分析看板设计文档**

**一、项目背景**

本页面分析看板旨在通过用户访问日志、页面模块曝光/点击行为数据，构建从原始数据到业务分析的多层数据模型，实现对页面模块点击热度、引导效果、转化漏斗等关键指标的监控和优化。

**二、数仓分层结构**

|**层级**|**说明**|**主要表**|
|---|---|---|
|**ODS**|**原始数据接入及轻度清洗**|**ods_page_visit_log  <br>ods_user_info  <br>ods_module_exposure_log  <br>ods_order_info**|
|**DIM**|**维度建模**|**dim_page_info  <br>dim_module_info**|
|**DWD**|**明细建模（宽表）**|**dwd_page_module_event_log**|
|**DWS**|**统计建模（轻聚合）**|**dws_page_module_stats_1d  <br>dws_page_guide_conversion_1d**|
|**ADS**|**应用建模（主题指标）**|**ads_page_module_click_rank  <br>ads_page_conversion_trend  <br>ads_module_guidance_effect  <br>ads_page_abnormal_modules**|

**三、ODS层表设计（原始数据接入）**

**1. ods_page_visit_log（用户访问日志表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**user_id**|**STRING**|**用户ID**|
|**page_id**|**STRING**|**页面ID**|
|**visit_time**|**TIMESTAMP**|**访问时间**|
|**module_id**|**STRING**|**模块ID（点击或浏览）**|
|**event_type**|**STRING**|**事件类型（click/view）**|
|**device_type**|**STRING**|**设备类型（mobile/pc）**|
|**session_id**|**STRING**|**会话ID**|

**数据来源说明：采集于前端埋点日志，包含访问行为、页面及模块交互数据。**

**2. ods_user_info（用户信息表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**user_id**|**STRING**|**用户ID**|
|**gender**|**STRING**|**性别**|
|**age**|**INT**|**年龄**|
|**register_time**|**TIMESTAMP**|**注册时间**|
|**city**|**STRING**|**城市**|

**数据来源说明：注册系统或CRM系统同步。**

**3. ods_module_exposure_log（模块曝光日志表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**module_id**|**STRING**|**模块ID**|
|**page_id**|**STRING**|**页面ID**|
|**user_id**|**STRING**|**用户ID**|
|**exposure_time**|**TIMESTAMP**|**曝光时间**|
|**session_id**|**STRING**|**会话ID**|

**数据来源说明：曝光日志，通常由前端曝光监听组件生成。**

**4. ods_order_info（订单信息表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**order_id**|**STRING**|**订单ID**|
|**user_id**|**STRING**|**用户ID**|
|**pay_time**|**TIMESTAMP**|**支付时间**|
|**product_id**|**STRING**|**商品ID**|
|**page_id**|**STRING**|**下单页面ID**|
|**module_id**|**STRING**|**下单模块ID**|

**数据来源说明：电商平台订单库，通过同步或接口获取。**

**DIM层表设计（维度建模）**

**1. dim_page_info（页面维度表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**page_id**|**STRING**|**页面ID**|
|**page_name**|**STRING**|**页面名称**|
|**page_type**|**STRING**|**页面类型**|

**2. dim_module_info（模块维度表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**module_id**|**STRING**|**模块ID**|
|**module_name**|**STRING**|**模块名称**|
|**module_type**|**STRING**|**模块类型**|

**DWD层表设计（明细建模）**

**dwd_page_module_event_log（页面模块事件明细表）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**业务日期**|
|**user_id**|**STRING**|**用户ID**|
|**page_id**|**STRING**|**页面ID**|
|**module_id**|**STRING**|**模块ID**|
|**event_type**|**STRING**|**事件类型（click/view）**|
|**event_time**|**TIMESTAMP**|**事件时间**|
|**is_expose**|**INT**|**是否曝光（0/1）**|
|**is_click**|**INT**|**是否点击（0/1）**|
|**is_pay**|**INT**|**是否支付（0/1）**|

**实现方案：通过ODS日志多表Join、字段标准化、行为标记形成宽表。**

**DWS层表设计（轻聚合）**

**1. dws_page_module_stats_1d（页面模块行为汇总）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**page_id**|**STRING**|**页面ID**|
|**module_id**|**STRING**|**模块ID**|
|**expose_cnt**|**BIGINT**|**曝光次数**|
|**click_cnt**|**BIGINT**|**点击次数**|
|**pay_cnt**|**BIGINT**|**支付次数**|
|**user_cnt**|**BIGINT**|**独立用户数**|

**实现方案：按dt/page/module维度分组聚合，统计行为计数和独立用户数。**

**2. dws_page_guide_conversion_1d（页面引导路径转化）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**page_id**|**STRING**|**页面ID**|
|**user_cnt**|**BIGINT**|**用户数**|
|**expose_cnt**|**BIGINT**|**曝光次数**|
|**click_cnt**|**BIGINT**|**点击次数**|
|**pay_cnt**|**BIGINT**|**支付次数**|

**实现方案：聚合点击路径上的全流程行为数据，形成引导效果路径视图。**

**ADS层表设计（核心指标呈现）**

**1. ads_page_module_click_rank（页面模块点击热度排行）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**module_id**|**STRING**|**模块ID**|
|**click_cnt**|**BIGINT**|**点击次数**|
|**rank_num**|**INT**|**排名**|

**指标定义：当日模块点击排行前N，主要用作热度分析和资源分配。**

**2. ads_page_conversion_trend（页面引导转化趋势）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**page_id**|**STRING**|**页面ID**|
|**click_cnt**|**BIGINT**|**点击数**|
|**pay_cnt**|**BIGINT**|**支付数**|
|**conversion_rate**|**DOUBLE**|**转化率**|

**指标定义：点击到支付的转化率走势，适合绘制折线图查看趋势。**

**3. ads_module_guidance_effect（各模块引导效果）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**module_id**|**STRING**|**模块ID**|
|**expose_cnt**|**BIGINT**|**曝光次数**|
|**click_cnt**|**BIGINT**|**点击次数**|
|**pay_cnt**|**BIGINT**|**支付次数**|
|**ctr**|**DOUBLE**|**点击率（click / expose）**|
|**cvr**|**DOUBLE**|**支付转化率（pay / click）**|

**指标定义：衡量模块引导能力，核心为CTR与CVR。**

**4. ads_page_abnormal_modules（引导效果差模块）**

|**字段名**|**类型**|**说明**|
|---|---|---|
|**dt**|**STRING**|**日期**|
|**module_id**|**STRING**|**模块ID**|
|**click_rate**|**DOUBLE**|**点击率**|
|**bounce_rate**|**DOUBLE**|**跳出率（模拟）**|
|**is_abnormal**|**INT**|**是否为异常模块（1=是）**|

**判断逻辑：CTR低于5%，或跳出率高于70%，标记为异常模块。**

**四、关键指标列表**

|   |   |
|---|---|
|指标名|说明|
|module_exposure_cnt|模块曝光次数|
|module_click_cnt|模块点击次数|
|module_pay_cnt|模块引导支付次数|
|click_rate|点击率 = 点击数 / 曝光数|
|guide_conversion_rate|引导转化率 = 支付数 / 曝光数|
|abnormal_flag|异常标识|

**五、实现方案说明**

**建模流程**

1. ODS抽数并清洗，使用PySpark读取原始数据写入Hive
2. DWD层按行为类型划分事实表，结构化用户行为日志
3. DWS层每日聚合，构建通用分析指标
4. ADS层为分析场景提供直接结果表（TOP榜、趋势、异常识别）

**关键技术**

- PySpark DSL编写数据处理脚本（兼容 Python 2.x）
- Hive外部表设计，支持增量加载与历史回溯
- 模块跳转路径分析使用前后模块对进行建模

**六、性能优化方案**

**1. 脚本优化**

- 避免嵌套查询，分步处理
- 广播维表如dim_page_module_info
- 合理使用 repartition() 降低Shuffle开销

**2. 数据结构优化**

- 所有表采用 partitioned by (dt)
- 使用Parquet格式提高读取效率

**3. 调度与缓存**

- 利用DataWorks或DolphinScheduler进行调度
- 热表结果可落地缓存到ADS中用于前端展示

**七、后续扩展建议**

- 新增跳出率、停留时长分析字段，进一步完善用户行为质量判断
- 接入A/B实验标识字段，对比不同模块设计转化效果差异
- 接入用户标签维度（新老用户、会员等级等）进行人群细分分析